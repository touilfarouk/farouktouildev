const APP={sw:null,deferredPrompt:null,isOnline:!("onLine"in navigator)||navigator.onLine,isStandalone:!1,init:()=>{APP.registerSW(),APP.addListeners(),setTimeout(APP.checkNavCount,5e3),APP.changeDisplay()},registerSW:async()=>{if("serviceWorker"in navigator)try{let e=await navigator.serviceWorker.register("/sw.js");APP.sw=e.active}catch(e){console.warn(e)}},addListeners:()=>{navigator.standalone||matchMedia("(display-mode: standalone)").matches?(console.log("Launched: Installed (iOS)"),APP.isStandalone=!0):(console.log("Launched: Browser Tab"),APP.isStandalone=!1),window.addEventListener("pageshow",APP.updateNavCount),window.addEventListener("online",APP.changeStatus),window.addEventListener("offline",APP.changeStatus),window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),APP.deferredPrompt=e,console.log("deferredPrompt saved")})},changeStatus:e=>{APP.isOnline="online"===e.type,APP.sendMessage({ONLINE:APP.isOnline}),APP.changeDisplay()},changeDisplay:()=>{let e=document.querySelector(".isonline");e.textContent=APP.isOnline?"Online":"Offline",e.classList.toggle("online-text",APP.isOnline),document.body.classList.toggle("offline",!APP.isOnline)},sendMessage:e=>{navigator.serviceWorker.ready.then(n=>n.active.postMessage(e)).catch(console.error)},updateNavCount:e=>{if(!APP.isStandalone){let e=sessionStorage.getItem("exercise3NavCount");APP.navCount=e?Number(e)+1:1,sessionStorage.setItem("exercise3NavCount",APP.navCount)}},checkNavCount:()=>{let e=sessionStorage.getItem("exercise3NavCount");if(e&&(APP.navCount=Number(e),APP.navCount>2)){console.log("show the prompt");let e=()=>{APP.deferredPrompt?(APP.deferredPrompt.prompt(),APP.deferredPrompt.userChoice.then(e=>{"accepted"===e.outcome?(console.log("User accepted the install prompt"),APP.deferredPrompt=null,sessionStorage.clear()):console.log("User dismissed the install prompt")}).catch(console.error)):window.addEventListener("beforeinstallprompt",n=>{console.log("beforeinstallprompt"),n.preventDefault(),APP.deferredPrompt=n,e()})};document.body.addEventListener("click",e,{once:!0})}}};document.addEventListener("DOMContentLoaded",APP.init);