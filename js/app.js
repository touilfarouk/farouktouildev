const APP={sw:null,deferredPrompt:null,isOnline:!("onLine"in navigator)||navigator.onLine,isStandalone:!1,init:()=>{APP.registerSW(),APP.addListeners(),setTimeout(APP.checkNavCount,5e3),APP.changeDisplay()},registerSW:()=>{"serviceWorker"in navigator&&(navigator.serviceWorker.register("/sw.js").catch(function(e){console.warn(e)}),navigator.serviceWorker.ready.then(e=>{APP.sw=e.active}))},addListeners:()=>{navigator.standalone||matchMedia("(display-mode: standalone)").matches?(console.log("Launched: Installed (iOS)"),APP.isStandalone=!0):(console.log("Launched: Browser Tab"),APP.isStandalone=!1),window.addEventListener("pageshow",APP.updateNavCount),window.addEventListener("online",APP.changeStatus),window.addEventListener("offline",APP.changeStatus),window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),APP.deferredPrompt=e,console.log("deferredPrompt saved")})},changeStatus:e=>{APP.isOnline="online"===e.type,APP.sendMessage({ONLINE:APP.isOnline}),APP.changeDisplay()},changeDisplay:()=>{let e=document.querySelector(".isonline");APP.isOnline?(document.body.classList.remove("offline"),e.textContent="Online",e.classList.add("online-text")):(document.body.classList.add("offline"),e.textContent="Offline",e.classList.remove("online-text"))},sendMessage:e=>{navigator.serviceWorker.ready.then(n=>{n.active.postMessage(e)})},updateNavCount:e=>{if(console.log(e),!APP.isStandalone){APP.navCount=0;let e=sessionStorage.getItem("exercise3NavCount");e?APP.navCount=Number(e)+1:APP.navCount=1,sessionStorage.setItem("exercise3NavCount",APP.navCount)}},checkNavCount:()=>{let e=sessionStorage.getItem("exercise3NavCount");if(e&&(APP.navCount=Number(e),APP.navCount>2)){console.log("show the prompt");let e=()=>{APP.deferredPrompt?(APP.deferredPrompt.prompt(),APP.deferredPrompt.userChoice.then(e=>{"accepted"===e.outcome?(console.log("User accepted the install prompt"),APP.deferredPrompt=null,sessionStorage.clear()):console.log("User dismissed the install prompt")})):window.addEventListener("beforeinstallprompt",n=>{console.log("beforeinstallprompt"),n.preventDefault(),APP.deferredPrompt=n,e()})};document.body.addEventListener("click",e,{once:!0})}}};document.addEventListener("DOMContentLoaded",APP.init);