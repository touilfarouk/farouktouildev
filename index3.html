<!DOCTYPE html>
<html>
<head>
  <title>Reverb Recorder App</title>
  <script src="http://reverbjs.org/reverb.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.26/Tone.js"></script>
</head>
<body>
  <button id="recordButton">Record</button>
  <button id="stopButton">Stop</button>
  <button id="playButton">Play</button>

  <script>
    var audioContext = new (window.AudioContext || window.webkitAudioContext)();
    reverbjs.extend(audioContext);

    var reverbUrl = "http://reverbjs.org/Library/church_hall_impulse.wav";
    var reverbNode = audioContext.createReverbFromUrl(reverbUrl, function() {
      reverbNode.connect(audioContext.destination);
    });

    var mediaRecorder;
    var chunks = [];
    var isRecording = false;

    function startRecording() {
      navigator.mediaDevices.getUserMedia({ audio: true })
        .then(function(stream) {
          mediaRecorder = new MediaRecorder(stream);
          mediaRecorder.addEventListener("dataavailable", function(event) {
            chunks.push(event.data);
          });
          mediaRecorder.start();
          isRecording = true;
          console.log("Recording started...");
        })
        .catch(function(err) {
          console.error("Error accessing microphone:", err);
        });
    }

    function stopRecording() {
      if (mediaRecorder && isRecording) {
        mediaRecorder.stop();
        isRecording = false;
        console.log("Recording stopped...");
      }
    }

    function playRecording() {
      if (chunks.length === 0) {
        console.log("No recording available to play.");
        return;
      }

      var audioBlob = new Blob(chunks, { type: "audio/webm" });
      var audioUrl = URL.createObjectURL(audioBlob);

      const player = new Tone.Player(audioUrl).toDestination();
      const compressor = new Tone.Compressor({
        ratio: 12,
        threshold: -24,
        attack: 0.003,
        release: 0.25
      }).toDestination();

      player.connect(compressor);

      player.start();
    }

    document.getElementById("recordButton").addEventListener("click", function() {
      startRecording();
    });

    document.getElementById("stopButton").addEventListener("click", function() {
      stopRecording();
    });

    document.getElementById("playButton").addEventListener("click", function() {
      playRecording();
    });
  </script>
</body>
</html>
