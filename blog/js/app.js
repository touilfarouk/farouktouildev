const APP={sw:null,deferredPrompt:null,isOnline:"onLine"in navigator&&navigator.onLine,init:()=>{APP.registerSW(),APP.addListeners(),setTimeout(APP.checkNavCount,5e3),APP.changeDisplay()},registerSW:()=>{"serviceWorker"in navigator&&(navigator.serviceWorker.register("/sw.js").catch(function(e){console.warn(e)}),navigator.serviceWorker.ready.then(e=>{APP.sw=e.active}))},addListeners:()=>{navigator.standalone?(console.log("Launched: Installed (iOS)"),APP.isStandalone=!0):matchMedia("(display-mode: standalone)").matches?(console.log("Launched: Installed"),APP.isStandalone=!0):APP.isStandalone=!1,window.addEventListener("pageshow",APP.updateNavCount),window.addEventListener("online",APP.changeStatus),window.addEventListener("offline",APP.changeStatus),window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),APP.deferredPrompt=e,console.log("deferredPrompt saved")})},changeStatus:e=>{APP.isOnline="online"===e.type,navigator.serviceWorker.ready.then(e=>{e.active.postMessage({ONLINE:APP.isOnline})}),APP.changeDisplay()},changeDisplay:()=>{APP.isOnline?(document.body.classList.remove("offline"),document.querySelector(".isonline").textContent=""):(document.body.classList.add("offline"),document.querySelector(".isonline").textContent=" NAWT ")},gotMessage:e=>{console.log(e.data)},sendMessage:e=>{navigator.serviceWorker.ready.then(n=>{n.active.postMessage(e)})},updateNavCount:e=>{if(console.log(e),!APP.isStandalone){APP.navCount=0;let e=sessionStorage.getItem("exercise3NavCount");e?APP.navCount=Number(e)+1:APP.navCount=1,sessionStorage.setItem("exercise3NavCount",APP.navCount)}},checkNavCount:()=>{let e=sessionStorage.getItem("exercise3NavCount");e&&(APP.navCount=Number(e),APP.navCount>2&&(console.log("show the prompt"),document.body.addEventListener("click",()=>{APP.deferredPrompt?(APP.deferredPrompt.prompt(),APP.deferredPrompt.userChoice.then(e=>{"accepted"===e.outcome?(console.log("User accepted the install prompt"),APP.deferredPrompt=null,sessionStorage.clear()):console.log("User dismissed the install prompt")})):window.addEventListener("beforeinstallprompt",e=>{console.log("beforeinstallprompt"),e.preventDefault(),APP.deferredPrompt=e})},{once:!0})))}};document.addEventListener("DOMContentLoaded",APP.init);